
<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Akumo Sklad</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="box">
    <div class="logo">AKUMO SKLAD</div>
    <div class="controls">
      <input type="text" id="query" placeholder="Zadej n√°zev polo≈æky..." />
      <button class="primary" onclick="hledat()">üîç</button>
    </div>
    <div id="history"></div>
    <div id="vysledek" class="vysledek"></div>
    <div class="footer muted">Tip: hledej bez diakritiky nebo jako zkratku (nap≈ô. ‚Äûhlavove slozeni, hlav‚Äú). </div>
  </div>

  <script>
    let data1 = {};
    let data2 = {};
    let data3 = {};
    let databaze = {};

    function normalize(str) {
      return (str || "").normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
    }

    function mergeData() {
      databaze = Object.assign({}, data1, data2, data3);
    }

    async function loadData() {
      const r1 = await fetch('data_table1.json');
      data1 = await r1.json();
      const r2 = await fetch('data_table2.json');
      data2 = await r2.json();
      const r3 = await fetch('data_table3.json');
      data3 = await r3.json();
      mergeData();
      zobrazHistorii();
    }

    function ulozitHistorii(dotaz) {
      if (!dotaz) return;
      let historie = JSON.parse(localStorage.getItem("skladHistorie")) || [];
      historie = historie.filter(item => item !== dotaz);
      historie.unshift(dotaz);
      if (historie.length > 10) historie = historie.slice(0, 10);
      localStorage.setItem("skladHistorie", JSON.stringify(historie));
      zobrazHistorii();
    }

    function zobrazHistorii() {
      const historie = JSON.parse(localStorage.getItem("skladHistorie")) || [];
      const el = document.getElementById("history");
      if (historie.length === 0) { el.innerHTML = ""; return; }
      el.innerHTML = "<strong>Posledn√≠ hledan√©:</strong><br>" + historie.map(h =>
        `<span class='item' onclick='document.getElementById("query").value=${JSON.stringify(h)};hledat();'>${h}</span>`
      ).join(", ");
    }

    function hledat() {
      const dotaz = normalize(document.getElementById("query").value.trim());
      ulozitHistorii(dotaz);
      if (!dotaz) return;
      let vysledky = "";
      for (const [nazev, pozice] of Object.entries(databaze)) {
        if (normalize(nazev).includes(dotaz)) {
          // pozice u≈æ obsahuje pln√Ω text "Um√≠stƒõn√≠ - ...: Sloupec X, ≈ô√°dek Y"
          vysledky += `<strong>${nazev}</strong><br>${pozice}<br><br>`;
        }
      }
      document.getElementById("vysledek").innerHTML = vysledky || "Hmmm, nic tu nen√≠ ‚Äì jdi za Jakubem";
    }

    loadData();
  </script>
</body>
</html>
